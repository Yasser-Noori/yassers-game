<html>
  <head>
    <meta charset='utf-8'>
    <title>Yasser Noori -- Gocket.io Game/title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>
// Connect to the server
let address = "https://server-djwxqxfveu.now.sh";
let socket = io(address);

socket.on("connect", () => socket.emit('newPlayer'));
socket.on("state", render);

// Render the Game
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

function render(players) {
  // Clear prior frame
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw players
  ctx.fillStyle = "red";
  for (id in players) {
    let player = players[id];
    ctx.fillRect(player.x, player.y, 50, 50);
  }
}

// Movement
let movement = {
  up: false,
  left: false,
  right: false,
  down: false
}

function broadcastMovement() {
  socket.emit("movement", movement);
}

// Controls

const keymap = {
  87: "up",
  65: "left",
  83: "down",
  68: "right"
};

function keydown(event) {
  const direction = keymap[event.keyCode];
  if (direction) movement[direction] = true;
}

function keyup(event) {
  const direction = keymap[event.keyCode];
  if (direction) movement[direction] = false;
}

window.addEventListener("keydown", keydown);
window.addEventListener("keyup", keyup);

setInterval(broadcastMovement, 1000 / 60);

    </script>
    <style>
body {
  padding: 20px;
}

canvas {
  display: block;
  background: #000;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
    </style>
  </head>
  <body>
    <p>Controls: WASD</p>
    <canvas id='canvas' style="width: 100%; height: 100%;"></canvas>
  </body>
</html>
